-- Change over Time analysis 
-- Purpose:
--    - To track trends, growth, and changes in key metrics over time.
--    - For time-series analysis and identifying seasonality.
--    - To measure growth or decline over specific periods.

-- SQL Functions Used:
--    - Date Functions: DATEPART(), DATETRUNC(), FORMAT()
--    - Aggregate Functions: SUM(), COUNT(), AVG()

-- Sales performance over time 
select order_date , sales_amount from gold.fact_sales
where order_date is not null
order by order_date ;

-- sum of total sales in a day 
select order_date , SUM(sales_amount) from gold.fact_sales
where order_date is not null
group by order_date
order by order_date ;

-- total sales , customers and quantity in a month
SELECT EXTRACT(Month FROM order_date) AS order_month, SUM(sales_amount) AS total_sales ,
Count (Distinct customer_key ) , SUM(quantity) as total_quantity FROM gold.fact_sales
WHERE order_date IS NOT NULL
GROUP BY order_month
ORDER BY order_month;

-- total sales , customers and quantity in a year 
SELECT EXTRACT(YEAR FROM order_date) AS order_year,
EXTRACT(Month FROM order_date) AS order_month ,
SUM(sales_amount) AS total_sales ,
Count (Distinct customer_key ) ,
SUM(quantity) as total_quantity FROM gold.fact_sales
WHERE order_date IS NOT NULL
GROUP BY order_year , order_month
ORDER BY order_year , order_month ;

-- Date_trunc
SELECT  DATE_TRUNC('month', order_date) AS order_month,
SUM(sales_amount) AS total_sales,
COUNT(DISTINCT customer_key) AS total_customers,
SUM(quantity) AS total_quantity
FROM gold.fact_sales
WHERE order_date IS NOT NULL
GROUP BY order_month
ORDER BY order_month;

-- Format 
SELECT  TO_CHAR(order_date, 'YYYY-Mon') AS order_month,
SUM(sales_amount) AS total_sales,
COUNT(DISTINCT customer_key) AS total_customers,
SUM(quantity) AS total_quantity
FROM gold.fact_sales
WHERE order_date IS NOT NULL
GROUP BY TO_CHAR(order_date, 'YYYY-Mon')
ORDER BY TO_CHAR(order_date, 'YYYY-Mon');

